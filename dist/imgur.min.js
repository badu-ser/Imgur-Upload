!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Imgur=t()}(this,(function(){"use strict";return class{clientid;endpoint;callback;dropzone;info;constructor(e){if(!e||!e.clientid)throw"Provide a valid Client Id here: https://api.imgur.com/";this.clientid=e.clientid,this.endpoint="https://api.imgur.com/3/image",this.callback=e.callback,this.dropzone=document.querySelectorAll(".dropzone"),this.info=document.querySelectorAll(".info"),this.run()}createEls(e,t,i){const a=document.createElement(e);for(const e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return i&&a.appendChild(document.createTextNode(i)),a}insertAfter(e,t){e.parentNode?.insertBefore(t,e.nextSibling)}async post(e,t){const i=await fetch(e,{method:"POST",headers:{Authorization:"Client-ID "+this.clientid},body:t});if(i.ok)return i.json();throw new Error(`HTTP error, status = ${i.status}`)}createDragZone(){const e=this.createEls("p",{},"Drop or Paste Image File Here"),t=this.createEls("p",{},"Or click here to select image"),i=this.createEls("input",{type:"file",multiple:"multiple",className:"input",accept:"image/*"});Array.from(this.info).forEach((i=>{i.appendChild(e),i.appendChild(t)})),Array.from(this.dropzone).forEach((e=>{e.appendChild(i),this.status(e),this.upload(e)})),window.addEventListener("paste",(e=>{const t=this.dropzone[0],i=(e.clipboardData||e.originalEvent?.clipboardData).items;for(let e=0;e<i.length;e++){const a=i[e];if("file"===a.kind&&a.type.startsWith("image")){const s=a.getAsFile();this.matchFiles(s,t,[e,i.length])}}}))}loading(){const e=this.createEls("div",{className:"loading-modal"}),t=this.createEls("table",{className:"loading-table"}),i=this.createEls("img",{className:"loading-image",src:"./css/loading-spin.svg"});e.appendChild(t),t.appendChild(i),document.body.appendChild(e)}status(e){const t=this.createEls("div",{className:"status"});this.insertAfter(e,t)}matchFiles(e,t,i){const a=t.nextSibling;if(e.type.match(/image/)&&"image/svg+xml"!==e.type){document.body.classList.add("loading"),a.classList.remove("bg-success","bg-danger"),a.innerHTML="";const t=new FormData;t.append("image",e),this.post(this.endpoint,t).then((e=>{i[0]+1===i[1]&&document.body.classList.remove("loading"),"function"==typeof this.callback&&this.callback.call(this,e)})).catch((e=>{throw a.classList.remove("bg-success"),a.classList.add("bg-danger"),a.innerHTML="Invalid archive",new Error(e)}))}else a.classList.remove("bg-success"),a.classList.add("bg-danger"),a.innerHTML="Invalid archive"}upload(e){const t=(e,t,i)=>{if(t.target&&"INPUT"===t.target.nodeName&&"file"===t.target.type&&("dragleave"===e||"drop"===e)){const e=t.target.parentElement;e&&e.classList[i]("dropzone-dragging")}};e.addEventListener("change",(t=>{if(t.target&&"INPUT"===t.target.nodeName&&"file"===t.target.type){const i=t.target.files;for(let t=0;t<i.length;t++)this.matchFiles(i[t],e,[t,i.length])}})),["dragenter","dragleave","dragover","drop"].forEach((i=>{e.addEventListener(i,(e=>t(i,e,"add")),!1),e.addEventListener(i,(e=>t(i,e,"remove")),!1)}))}run(){document.querySelector(".loading-modal")||this.loading(),this.createDragZone()}}}));
